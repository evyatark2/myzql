name: Integration Tests

on:
  push:
    branches:
     - main
  pull_request:
    branches:
     - main

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: run mysql server
        run: |
          docker run --name some-mysql --env MYSQL_ALLOW_EMPTY_PASSWORD=1 -p 3306:3306 -d mysql
      
      - uses: actions/checkout@v3

      - name: install zig
        run: |
          # curl -L https://ziglang.org/download/ > page.xml
          # ZIG_VERSION=$(cat page.xml | tidy -html 2> /dev/null | grep zig-linux-x86_64 | head -n 1 | cut -d '-' -f 4,5 | cut -d '.' -f 1,2,3,4)
          ZIG_VERSION=0.12.0-dev.897+2769215b9
          echo "zig version: $ZIG_VERSION"
          wget https://ziglang.org/builds/zig-linux-x86_64-$ZIG_VERSION.tar.xz
          tar xf zig-linux-x86_64-$ZIG_VERSION.tar.xz
          mv zig-linux-x86_64-$ZIG_VERSION $HOME/zig-build

      - name: run the tests
        run: |
          $HOME/zig-build/zig test src/myzql.zig
